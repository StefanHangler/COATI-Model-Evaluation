# COATI-Model-Evaluation
This repository contains all necessary materials and code for replicating the experiments and analyses presented in my report on the [COATI model](https://github.com/terraytherapeutics/COATI). It includes detailed scripts and notebooks for training the model from scratch using the GuacaMol dataset, conducting linear probing tasks, and analyzing molecular generation capabilities.

# Setup Installation

1. **Clone the Repository:**
   Clone the repository to your local machine to get started with the setup.

   ```bash
   git clone https://github.com/StefanHangler/COATI-Model-Evaluation.git
   cd molecule-generation
   ```

2. **Create and Activate a Virtual Environment:**
   - For Unix/macOS systems:
     ```bash
     python3 -m venv env
     source env/bin/activate
     ```
   - For Windows:
     ```bash
     python -m venv env
     .\env\Scripts\activate
     ```

3. **Install the Package:**
   Install the package using `pip` which will handle all dependencies automatically.

   ```bash
   pip install .
   ```

This will install the COATI-Model-Evaluation package and all required dependencies, setting up the environment for running or extending the application.

# Molecule Generation
This repository contains a Python script for generating molecular structures using various pretrained PyTorch models. The models are implemented following an abstract base class to ensure a consistent interface for molecule generation.

## Features
- Abstract base class for molecule generators to ensure consistency and reusability.
- Predefined classes for generating molecules with specific pretrained models.
- Easy extension to include new molecule generation models.

## Generating Molecules

### Run Script
Execute the main script to generate molecules:
```
python generate_molecules.py
```

This will generate molecules using all configured models and save them to CSV files in the current directory.

### Adding a New Model

To add a new model for molecule generation, follow these steps:

1. **Implement the New Model Class:**
   Create a new Python class that inherits from `MoleculeGenerator`. Implement all abstract methods:
   - `load_model()`: Method to load your model and tokenizer.
   - `generate_molecules()`: Method to generate molecules using the model.

   Example:
   ```python
   class NewModelGenerator(MoleculeGenerator):
       def __init__(self, device, doc_url):
           super().__init__(device)
           self.doc_url = doc_url
           self.model, self.tokenizer = self.load_model()

       def load_model(self):
           # Load your model and tokenizer here
           return model, tokenizer

       def generate_molecules(self, num_molecules=100):
           # Logic to generate molecules
           return generated_molecules
   ```

2. **Integrate the New Model into the Main Script:**
   Instantiate your model in the main script and call the `generate_molecules()` method.
   
   ```python
   new_model = NewModelGenerator(device, model_url)
   molecules = new_model.generate_molecules(100)
   new_model.save_molecules(molecules, "new_model_generated_molecules.csv")
   ```

## Evaluating Generated Molecules

The provided script offers comprehensive evaluation metrics for generated molecules, including validity, novelty, uniqueness, and the Fr√©chet ChemNet Distance (FCD) score. These metrics are crucial for assessing the quality of molecules generated by different models.

### Evaluation Metrics

- **Validity**: Measures the percentage of chemically valid molecules using RDKit.
- **Novelty**: Measures the proportion of generated molecules that are not found in the training set.
- **Uniqueness**: Assesses how unique the generated molecules are within the generated set.
- **FCD Score**: Compares the distribution of generated molecules to a reference set using a deep learning model to compute the FCD.

### Running the Evaluation

To evaluate generated molecules, follow these steps:

1. **Prepare your dataset**: Ensure your generated molecules are stored in a format compatible with the script, typically as `.csv` files containing SMILES strings.
2. **Specify the paths**: Modify the `path_list` dictionary in the script to point to your generated molecule files.
3. **Load training data**: Update the `training_smiles_path` variable to point to your training dataset. This dataset is used to compute novelty and as a reference for the FCD.
4. **Run the script**: Execute the script to calculate the evaluation metrics. Results are printed to the console and can be saved to a CSV file for further analysis.

### Example Usage

Here is an example of how to call the evaluation function for a set of generated molecules:

```python
from guacamol.evaluate_guacamol import evaluate_guacamol

generated_smiles = ["CCO", "Oc1ccccc1"]
training_smiles = ["CCO", "CC"]

evaluate_guacamol(
    generated_smiles=generated_smiles,
    training_smiles=training_smiles,
    model_name="ExampleModel"
)
```

This will output the validity, novelty, uniqueness, and FCD score for the `ExampleModel`. Adjust the `training_smiles` and `generated_smiles` variables as necessary to reflect your datasets.

# License

This project is licensed under the MIT License - see the [LICENSE.md](LICENSE) file for details.
